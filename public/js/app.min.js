(function(e){e.fn.fallback=function(t){var n={preLoad:function(t){e(t).hide()},onLoad:function(t){e(t).fadeIn(200)},fallback:null},t=e.extend(n,t);return this.each(function(){this.complete?t.onLoad(this):(t.preLoad(this),e(this).error(function(){e(this).attr("src",e(this).data("fallback")||t.fallback)}).load(function(){t.onLoad(this)}))})}})($),$.fn.customiseFileInput=function(){return $(this).each(function(){var e=$("<div class='customfile'></div>"),t=$("<span class='customfile-button' aria-hidden='true'>Browse...</span>").appendTo(e),n=$("<span class='customfile-feedback' aria-hidden='true'>No file selected</span>").appendTo(e),r=$(this).addClass("customfile-input").mouseover(function(){e.addClass("customfile-hover")}).mouseout(function(){e.removeClass("customfile-hover")}).focus(function(){e.addClass("customfile-focus"),r.data("val",r.val())}).blur(function(){e.removeClass("customfile-focus"),$(this).trigger("checkChange")}).bind("disable",function(){r.attr("disabled",!0),e.addClass("customfile-disabled")}).bind("enable",function(){r.removeAttr("disabled"),e.removeClass("customfile-disabled")}).bind("checkChange",function(){r.val()&&r.val()!==r.data("val")&&r.trigger("change")}).bind("change",function(){var e=$(this).val().split(/\\/).pop(),r="customfile-ext-"+e.split(".").pop().toLowerCase();n.text(e).removeClass(n.data("ext")||"").addClass(r).data("ext",r).addClass("customfile-feedback-populated"),t.text("Change...")}).click(function(){r.data("val",r.val()),setTimeout(function(){r.trigger("checkChange")},100)});r.is("[disabled]")&&r.trigger("disable"),e.mousemove(function(t){r.css({left:t.pageX-e.offset().left-r.outerWidth()+20,top:t.pageY-e.offset().top-$(window).scrollTop()-3})}).insertAfter(r),r.appendTo(e)})},$(function(){i18n.init({ns:{namespaces:["main","help"],defaultNs:"main"},cookieName:"locale",preload:["en"],fallbackLng:"en",getAsync:!1}),i18n.addPostProcessor("capitalize",function(e,t,n){return e.capitalize()}),i18n.addPostProcessor("titleize",function(e,t,n){return e.titleize()}),i18n.addPostProcessor("lower",function(e,t,n){return e.toLowerCase()}),i18n.addPostProcessor("upper",function(e,t,n){return e.toUpperCase()}),Handlebars.registerHelper("t",function(e,t){return new Handlebars.SafeString(i18n.t(e,t?{postProcess:t}:{}))}),Handlebars.registerHelper("formatEmail",function(e){return e===undefined?"":e.replace("."," dot ").replace("@"," at ")}),Handlebars.registerHelper("include",function(e,t){var n=Handlebars.partials[e],r=_.extend({},this,t.hash);return new Handlebars.SafeString(n(r))}),Handlebars.registerHelper("markdown",function(e){var t=new Showdown.converter;return new Handlebars.SafeString(t.makeHtml(i18n.t(e)))}),Handlebars.registerHelper("options",function(e,t,n){var r=e.split(" "),i="";for(var s=0,o=r.length;s<o;s++)i+=n.fn({opt:r[s],value:t});return i}),Handlebars.registerHelper("option",function(e){var t=e.opt,n=e.value,r="";return(t||"").toLowerCase()===(n||"").toLowerCase()&&(r="selected"),new Handlebars.SafeString("<option id='"+t+"' "+r+">"+i18n.t(t)+"</option>")})}),this.Templates=this.Templates||{},Handlebars.registerPartial("button",Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='  <button autocomplete="off" data-loading-text="<i class=\'icon-',u=n.icon,u?o=u.call(t,{hash:{}}):(o=t.icon,o=typeof o===a?o():o),s+=f(o)+" icon-white'></i>&nbsp;&nbsp;",o=t.loading,u=n.t,o=u?u.call(t,o,{hash:{}}):l.call(t,"t",o,{hash:{}}),s+=f(o)+'" class="btn btn-success" id="save"><i class="icon-',u=n.icon,u?o=u.call(t,{hash:{}}):(o=t.icon,o=typeof o===a?o():o),s+=f(o)+' icon-white"></i>&nbsp;&nbsp;',o=t.text,u=n.t,o=u?u.call(t,o,{hash:{}}):l.call(t,"t",o,{hash:{}}),s+=f(o)+" &rarr;</button>\n",s})),Handlebars.registerPartial("file",Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="control-group">\n  <label for="',u=n.field,u?o=u.call(t,{hash:{}}):(o=t.field,o=typeof o===a?o():o),s+=f(o)+'">',o=t.label,u=n.t,o=u?u.call(t,o,{hash:{}}):l.call(t,"t",o,{hash:{}}),s+=f(o)+'</label>\n  <div class="controls">\n    <input type="file" id="',u=n.field,u?o=u.call(t,{hash:{}}):(o=t.field,o=typeof o===a?o():o),s+=f(o)+'" name="',u=n.field,u?o=u.call(t,{hash:{}}):(o=t.field,o=typeof o===a?o():o),s+=f(o)+'" class="span',u=n.width,u?o=u.call(t,{hash:{}}):(o=t.width,o=typeof o===a?o():o),s+=f(o)+'" data-error-style="tooltip">\n  </div>\n</div>\n',s})),Handlebars.registerPartial("input",Handlebars.template(function(e,t,n,r,i){function h(e,t){return" required "}n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+='<div class="control-group">\n  <label for="',u=n.field,u?o=u.call(t,{hash:{}}):(o=t.field,o=typeof o===a?o():o),s+=f(o)+'">',o=t.label,u=n.t,o=u?u.call(t,o,{hash:{}}):l.call(t,"t",o,{hash:{}}),s+=f(o)+'</label>\n  <div class="controls">\n    <input type="text" id="',u=n.field,u?o=u.call(t,{hash:{}}):(o=t.field,o=typeof o===a?o():o),s+=f(o)+'" name="',u=n.field,u?o=u.call(t,{hash:{}}):(o=t.field,o=typeof o===a?o():o),s+=f(o)+'" class="span',u=n.width,u?o=u.call(t,{hash:{}}):(o=t.width,o=typeof o===a?o():o),s+=f(o)+" ",o=t.required,o=n["if"].call(t,o,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(o||o===0)s+=o;return s+='" value="',u=n.value,u?o=u.call(t,{hash:{}}):(o=t.value,o=typeof o===a?o():o),s+=f(o)+'" data-error-style="tooltip">\n  </div>\n</div>\n',s})),Handlebars.registerPartial("select",Handlebars.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+="\n        ",s=n.option,i=s?s.call(e,e,{hash:{}}):f.call(e,"option",e,{hash:{}}),r+=l(i)+"\n      ",r}n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="control-group">\n  <label for="',a=n.field,a?o=a.call(t,{hash:{}}):(o=t.field,o=typeof o===c?o():o),s+=l(o)+'">',o=t.label,a=n.t,o=a?a.call(t,o,{hash:{}}):f.call(t,"t",o,{hash:{}}),s+=l(o)+'</label>\n  <div class="controls">\n    <select id="',a=n.field,a?o=a.call(t,{hash:{}}):(o=t.field,o=typeof o===c?o():o),s+=l(o)+'" name="',a=n.field,a?o=a.call(t,{hash:{}}):(o=t.field,o=typeof o===c?o():o),s+=l(o)+'" style="width: ',a=n.width,a?o=a.call(t,{hash:{}}):(o=t.width,o=typeof o===c?o():o),s+=l(o)+'">\n\n      ',o=t.value,u=t.options,a=n.options,o=a?a.call(t,u,o,{hash:{},inverse:h.noop,fn:h.program(1,p,i)}):f.call(t,"options",u,o,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(o||o===0)s+=o;return s+="\n    </select>\n  </div>\n</div>\n",s})),this.Templates["administration/organisations/empty"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="alert fade in">\n  <i class="icon-exclamation-sign"></i> ',u=n.t,o=u?u.call(t,"organisations.not_found","capitalize",{hash:{}}):a.call(t,"t","organisations.not_found","capitalize",{hash:{}}),s+=f(o)+"\n</div>\n",s}),this.Templates["administration/organisations/filter"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<h1>",u=n.t,o=u?u.call(t,"main.organisations",{hash:{}}):a.call(t,"t","main.organisations",{hash:{}}),s+=f(o)+'</h1>\n<form class="navbar-form pull-left">\n  <input type="text" class="span3 search" id="search" placeholder="',u=n.t,o=u?u.call(t,"organisations.search",{hash:{}}):a.call(t,"t","organisations.search",{hash:{}}),s+=f(o)+'&rarr;"/>\n</form>\n\n<div class="btn-toolbar" style="margin: 0">\n  <div class="btn-group">\n\n    <button class="btn" data-toggle="dropdown" href="#">\n      ',u=n.t,o=u?u.call(t,"organisations.sort",{hash:{}}):a.call(t,"t","organisations.sort",{hash:{}}),s+=f(o)+'\n      <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu">\n      <li><a class="sort" href="#" data-sort="description">',u=n.t,o=u?u.call(t,"organisations.description",{hash:{}}):a.call(t,"t","organisations.description",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a class="sort" href="#" data-sort="code">',u=n.t,o=u?u.call(t,"organisations.code",{hash:{}}):a.call(t,"t","organisations.code",{hash:{}}),s+=f(o)+'</a></li>\n    </ul>\n    <button class="btn refresh" href="#"><i class="icon-refresh"></i> ',u=n.t,o=u?u.call(t,"organisations.all",{hash:{}}):a.call(t,"t","organisations.all",{hash:{}}),s+=f(o)+'</button>\n  </div>    \n  <div class="btn-group pull-right">\n    <button class="btn btn-success" href="#"><i class="icon-cog icon-white"></i> ',u=n.t,o=u?u.call(t,"organisations.register",{hash:{}}):a.call(t,"t","organisations.register",{hash:{}}),s+=f(o)+"</button>\n  </div>\n</div>\n\n\n",s}),this.Templates["administration/organisations/info"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression;return s+="<fieldset>\n  ",o={},o.field="description",u=t.description,o.value=u,o.width=4,o.required=!0,o.label="organisations.description",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n  ",o={},o.field="code",u=t.code,o.value=u,o.width=2,o.required=!0,o.label="organisations.code",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n</fieldset>\n",s}),this.Templates["administration/organisations/item"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<a data-id="',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'" data-page="',u=n.page,u?o=u.call(t,{hash:{}}):(o=t.page,o=typeof o===a?o():o),s+=f(o)+'" class="item ',u=n.active,u?o=u.call(t,{hash:{}}):(o=t.active,o=typeof o===a?o():o),s+=f(o)+'" href="#administration/organisations/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+"/",u=n.page,u?o=u.call(t,{hash:{}}):(o=t.page,o=typeof o===a?o():o),s+=f(o)+'">',u=n.description,u?o=u.call(t,{hash:{}}):(o=t.description,o=typeof o===a?o():o),s+=f(o)+"\n  <small>",u=n.code,u?o=u.call(t,{hash:{}}):(o=t.code,o=typeof o===a?o():o),s+=f(o)+'</small>\n  <i class="icon-chevron-right"></i>\n</a>\n',s}),this.Templates["administration/organisations/layout"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<div id="pages">\n  <header class="navbar" id="filter"></header>\n\n  <div id="page">\n    <div id="sidebar" class="auto-height">\n      <nav id="selector"></nav>\n    </div>\n\n    <section>\n      <div id="content" class="auto-height">\n        <div id="menu"></div>\n\n        <div id="message"></div>\n\n        <div id="inner"></div>\n\n        <aside id="aside" class="auto-height"></aside>\n      </div>\n    </section>\n\n  </div>\n</div>\n'}),this.Templates["administration/organisations/menu"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="navbar navbar-static-top">\n  <div class="navbar-inner">\n    <a class="brand" data-page="info" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'">',u=n.code,u?o=u.call(t,{hash:{}}):(o=t.code,o=typeof o===a?o():o),s+=f(o)+'</a>\n    <ul class="nav">\n      <li><a data-page="info" href="#administration/organisations/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'">',u=n.t,o=u?u.call(t,"organisations.info",{hash:{}}):l.call(t,"t","organisations.info",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a data-page="photos" href="#administration/organisations/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/photos">',u=n.t,o=u?u.call(t,"photos.photos",{hash:{}}):l.call(t,"t","photos.photos",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a data-page="documents" href="#administration/organisations/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/documents">',u=n.t,o=u?u.call(t,"documents.documents",{hash:{}}):l.call(t,"t","documents.documents",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a data-page="security" href="#administration/organisations/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/security">',u=n.t,o=u?u.call(t,"organisations.security",{hash:{}}):l.call(t,"t","organisations.security",{hash:{}}),s+=f(o)+'</a></li>\n    </ul>\n    <ul class="nav pull-right action">\n      <li><a data-page="role" href="#administration/organisations/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/role">',u=n.t,o=u?u.call(t,"organisations.add_role",{hash:{}}):l.call(t,"t","organisations.add_role",{hash:{}}),s+=f(o)+"</a></li>\n    </ul>\n  </div>\n</div>\n",s}),this.Templates["administration/organisations/selector"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<ul class="list"></ul>\n\n<div class="pagination pagination-centered"></div>'}),this.Templates["administration/organisations/summary"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<h4 class="organisation">',u=n.description,u?o=u.call(t,{hash:{}}):(o=t.description,o=typeof o===a?o():o),s+=f(o)+" <small>",u=n.code,u?o=u.call(t,{hash:{}}):(o=t.code,o=typeof o===a?o():o),s+=f(o)+'</small></h4>\n<div class="image"><img src="/api/organisation/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/photos/view/small"></img></div>\n<button class="btn btn-danger" href="#"><i class="icon-ban-circle icon-white"></i> ',u=n.t,o=u?u.call(t,"organisations.archive",{hash:{}}):l.call(t,"t","organisations.archive",{hash:{}}),s+=f(o)+" ",u=n.code,u?o=u.call(t,{hash:{}}):(o=t.code,o=typeof o===a?o():o),s+=f(o)+"</button>\n",s}),this.Templates["app/header"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<nav class="navbar navbar-inverse">\n  <div class="navbar-inner">\n    <div class="container-fluid">\n      <a class="brand" href="#"><span class="logo">',u=n.t,o=u?u.call(t,"main.title",{hash:{}}):a.call(t,"t","main.title",{hash:{}}),s+=f(o)+'</span></a>\n\n      <div id="security"></div>\n      <div id="locale"></div>\n      \n    </div>\n  </div>\n</nav> ',s}),this.Templates["app/locale"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<ul class="pull-right nav">\n  <li class="fr"><a class="locale" href="#fr" data-locale="fr">français</a></li>\n  <li class="de"><a class="locale" href="#de" data-locale="de">deutsch</a></li>\n  <li class="en"><a class="locale" href="#en" data-locale="en">english</a></li>\n</ul>\n'}),this.Templates["app/message"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<div class="alert alert-',u=n.color,u?o=u.call(t,{hash:{}}):(o=t.color,o=typeof o===a?o():o),s+=f(o)+' fade in">\n	<button type="button" class="close" data-dismiss="alert">×</button>\n  <i class="icon ',u=n.icon,u?o=u.call(t,{hash:{}}):(o=t.icon,o=typeof o===a?o():o),s+=f(o)+'"></i>&nbsp;<strong>',u=n.heading,u?o=u.call(t,{hash:{}}):(o=t.heading,o=typeof o===a?o():o),s+=f(o)+"</strong> ",u=n.text,u?o=u.call(t,{hash:{}}):(o=t.text,o=typeof o===a?o():o),s+=f(o)+"\n</div>\n",s}),this.Templates["app/navigation"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<ul>\n  <li><a class="home" href="#" rel="tooltip" title="',u=n.t,o=u?u.call(t,"main.home",{hash:{}}):a.call(t,"t","main.home",{hash:{}}),s+=f(o)+'" data-placement="right"><i class="icon-globe icon-white"></i></a></li>\n  <li><a class="people" href="#people" rel="tooltip" title="',u=n.t,o=u?u.call(t,"main.people",{hash:{}}):a.call(t,"t","main.people",{hash:{}}),s+=f(o)+'" data-placement="right"><i class="icon-user icon-white"></i></a></li>\n  <li><a class="administration" href="#administration" rel="tooltip" title="',u=n.t,o=u?u.call(t,"main.administration",{hash:{}}):a.call(t,"t","main.administration",{hash:{}}),s+=f(o)+'" data-placement="right"><i class="icon-cog icon-white"></i></a></li>\n  <li><a class="support" href="#support" rel="tooltip" title="',u=n.t,o=u?u.call(t,"main.support",{hash:{}}):a.call(t,"t","main.support",{hash:{}}),s+=f(o)+'" data-placement="right"><i class="icon-info-sign icon-white"></i></a></li>\n</ul>\n',s}),this.Templates["app/question"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="alert alert-',u=n.color,u?o=u.call(t,{hash:{}}):(o=t.color,o=typeof o===a?o():o),s+=f(o)+' fade in">\n  <h4 class="alert-heading">',u=n.heading,u?o=u.call(t,{hash:{}}):(o=t.heading,o=typeof o===a?o():o),s+=f(o)+"</h4>\n  <p>",u=n.text,u?o=u.call(t,{hash:{}}):(o=t.text,o=typeof o===a?o():o),s+=f(o)+'</p>\n  <p>\n    <button class="btn btn-danger yes">',o=t.yes,u=n.t,o=u?u.call(t,o,{hash:{}}):l.call(t,"t",o,{hash:{}}),s+=f(o)+'</button>\n    <button class="btn no">',o=t.no,u=n.t,o=u?u.call(t,o,{hash:{}}):l.call(t,"t",o,{hash:{}}),s+=f(o)+"</button>\n  </p>\n</div>\n",s}),this.Templates["documents/item"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s,o,u="function",a=this.escapeExpression;return o=n.id,o?s=o.call(t,{hash:{}}):(s=t.id,s=typeof s===u?s():s),a(s)}),this.Templates["home/layout"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<div id="pages">\n  <header id="top"></header>\n\n  <div id="page">\n    <div id="sidebar" class="auto-height">\n      <div id="summary"></div>\n    </div>\n\n    <section>\n      <div id="content" class="auto-height">\n        <div id="menu"></div>\n\n        <div id="message"></div>\n\n        <div id="inner"></div>\n\n        <aside id="aside" class="auto-height"></aside>\n      </div>\n    </section>\n\n  </div>\n</div>\n'}),this.Templates["home/navigation"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<h1>",u=n.t,o=u?u.call(t,"main.home",{hash:{}}):a.call(t,"t","main.home",{hash:{}}),s+=f(o)+'</h1>\n\n<ul class="nav nav-pills">\n  <li class="active"><a data-page="info" href="#profile">',u=n.t,o=u?u.call(t,"main.profile",{hash:{}}):a.call(t,"t","main.profile",{hash:{}}),s+=f(o)+'</a></li>\n  <li><a data-page="photos" href="#notifications">',u=n.t,o=u?u.call(t,"main.notifications",{hash:{}}):a.call(t,"t","main.notifications",{hash:{}}),s+=f(o)+"</a></li>\n</ul>\n",s}),this.Templates["home/summary"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<h4 class="person">',o=t.person,o=o==null||o===!1?o:o.firstName,o=typeof o===a?o():o,s+=f(o)+" ",o=t.person,o=o==null||o===!1?o:o.lastName,o=typeof o===a?o():o,s+=f(o)+'</h4>\n<p>\n  <a href="tel:',o=t.person,o=o==null||o===!1?o:o.telephone,o=typeof o===a?o():o,s+=f(o)+'">',o=t.person,o=o==null||o===!1?o:o.telephone,o=typeof o===a?o():o,s+=f(o)+'</a>\n</p>\n<p>\n  <a href="mailto:',o=t.person,o=o==null||o===!1?o:o.email,o=typeof o===a?o():o,s+=f(o)+'">',o=t.person,o=o==null||o===!1?o:o.email,u=n.formatEmail,o=u?u.call(t,o,{hash:{}}):l.call(t,"formatEmail",o,{hash:{}}),s+=f(o)+"</a>\n</p>\n\n\n",s}),this.Templates["people/empty"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="alert fade in">\n  <i class="icon-exclamation-sign"></i> ',u=n.t,o=u?u.call(t,"people.not_found","capitalize",{hash:{}}):a.call(t,"t","people.not_found","capitalize",{hash:{}}),s+=f(o)+"\n</div>\n",s}),this.Templates["people/filter"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<h1>",u=n.t,o=u?u.call(t,"main.people",{hash:{}}):a.call(t,"t","main.people",{hash:{}}),s+=f(o)+'</h1>\n<form class="navbar-form pull-left">\n  <input type="text" class="span3 search" id="search" placeholder="',u=n.t,o=u?u.call(t,"people.search",{hash:{}}):a.call(t,"t","people.search",{hash:{}}),s+=f(o)+'&rarr;"/>\n</form>\n\n<div class="btn-toolbar" style="margin: 0">\n  <div class="btn-group">\n\n    <button class="btn" data-toggle="dropdown" href="#">\n      ',u=n.t,o=u?u.call(t,"people.sort",{hash:{}}):a.call(t,"t","people.sort",{hash:{}}),s+=f(o)+'\n      <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu">\n      <li><a class="sort" href="#" data-sort="firstName">',u=n.t,o=u?u.call(t,"people.first_name",{hash:{}}):a.call(t,"t","people.first_name",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a class="sort" href="#" data-sort="lastName">',u=n.t,o=u?u.call(t,"people.last_name",{hash:{}}):a.call(t,"t","people.last_name",{hash:{}}),s+=f(o)+'</a></li>\n    </ul>\n    <button class="btn refresh" href="#"><i class="icon-refresh"></i> ',u=n.t,o=u?u.call(t,"people.all",{hash:{}}):a.call(t,"t","people.all",{hash:{}}),s+=f(o)+'</button>\n  </div>    \n  <div class="btn-group pull-right">\n    <button class="btn btn-success" href="#"><i class="icon-user icon-white"></i> ',u=n.t,o=u?u.call(t,"people.register",{hash:{}}):a.call(t,"t","people.register",{hash:{}}),s+=f(o)+"</button>\n  </div>\n</div>\n\n\n",s}),this.Templates["people/info"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression;return s+="<fieldset>\n  ",o={},o.field="firstName",u=t.firstName,o.value=u,o.width=4,o.required=!0,o.label="people.first_name",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n  ",o={},o.field="lastName",u=t.lastName,o.value=u,o.width=4,o.required=!0,o.label="people.last_name",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n  \n  ",o={},o.field="gender",u=t.gender,o.value=u,o.width="150px",o.options="male female",o.label="people.gender",a=n.include,o=a?a.call(t,"select",{hash:o}):f.call(t,"include","select",{hash:o}),s+=l(o)+"\n  ",o={},o.field="title",u=t.title,o.value=u,o.width="150px",o.options="mr mrs miss ms dr",o.label="people.title",a=n.include,o=a?a.call(t,"select",{hash:o}):f.call(t,"include","select",{hash:o}),s+=l(o)+"\n\n  ",o={},o.field="email",u=t.email,o.value=u,o.width=4,o.label="people.email",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n  ",o={},o.field="telephone",u=t.telephone,o.value=u,o.width=2,o.label="people.telephone",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n</fieldset>\n",s}),this.Templates["people/item"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<a data-id="',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'" data-page="',u=n.page,u?o=u.call(t,{hash:{}}):(o=t.page,o=typeof o===a?o():o),s+=f(o)+'" class="item ',u=n.active,u?o=u.call(t,{hash:{}}):(o=t.active,o=typeof o===a?o():o),s+=f(o)+'" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+"/",u=n.page,u?o=u.call(t,{hash:{}}):(o=t.page,o=typeof o===a?o():o),s+=f(o)+'">',u=n.firstName,u?o=u.call(t,{hash:{}}):(o=t.firstName,o=typeof o===a?o():o),s+=f(o)+" ",u=n.lastName,u?o=u.call(t,{hash:{}}):(o=t.lastName,o=typeof o===a?o():o),s+=f(o)+"\n	<small>",o=t.group,o=o==null||o===!1?o:o.name,o=typeof o===a?o():o,s+=f(o)+'</small>\n	<i class="icon-chevron-right"></i>\n</a>\n',s}),this.Templates["people/layout"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<div id="pages">\n  <header class="navbar" id="filter"></header>\n\n  <div id="page">\n    <div id="sidebar" class="auto-height">\n      <nav id="selector"></nav>\n    </div>\n\n    <section>\n      <div id="content" class="auto-height">\n        <div id="menu"></div>\n\n        <div id="message"></div>\n\n        <div id="inner"></div>\n\n        <aside id="aside" class="auto-height"></aside>\n      </div>\n    </section>\n\n  </div>\n</div>\n'}),this.Templates["people/menu"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="navbar navbar-static-top">\n  <div class="navbar-inner">\n    <a class="brand" data-page="info" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'">',u=n.firstName,u?o=u.call(t,{hash:{}}):(o=t.firstName,o=typeof o===a?o():o),s+=f(o)+'</a>\n    <ul class="nav">\n      <li><a data-page="info" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'">',u=n.t,o=u?u.call(t,"people.info",{hash:{}}):l.call(t,"t","people.info",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a data-page="photos" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/photos">',u=n.t,o=u?u.call(t,"photos.photos",{hash:{}}):l.call(t,"t","photos.photos",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a data-page="documents" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/documents">',u=n.t,o=u?u.call(t,"documents.documents",{hash:{}}):l.call(t,"t","documents.documents",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a data-page="account" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/account">',u=n.t,o=u?u.call(t,"people.account",{hash:{}}):l.call(t,"t","people.account",{hash:{}}),s+=f(o)+'</a></li>\n      <li><a data-page="permissions" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/permissions">',u=n.t,o=u?u.call(t,"people.permissions",{hash:{}}):l.call(t,"t","people.permissions",{hash:{}}),s+=f(o)+'</a></li>\n    </ul>\n    <ul class="nav pull-right action">\n      <li><a data-page="photo" href="#people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/photo">',u=n.t,o=u?u.call(t,"photos.upload",{hash:{}}):l.call(t,"t","photos.upload",{hash:{}}),s+=f(o)+"</a></li>\n    </ul>\n  </div>\n</div>\n",s}),this.Templates["people/register"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,"register.html"}),this.Templates["people/selector"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<ul class="list"></ul>\n\n<div class="pagination pagination-centered"></div>'}),this.Templates["people/summary"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<h4 class="person ',u=n.gender,u?o=u.call(t,{hash:{}}):(o=t.gender,o=typeof o===a?o():o),s+=f(o)+'">',u=n.firstName,u?o=u.call(t,{hash:{}}):(o=t.firstName,o=typeof o===a?o():o),s+=f(o)+" ",u=n.lastName,u?o=u.call(t,{hash:{}}):(o=t.lastName,o=typeof o===a?o():o),s+=f(o)+" <small>",o=t.group,o=o==null||o===!1?o:o.name,o=typeof o===a?o():o,s+=f(o)+'</small></h4>\n<div class="image"><img src="/api/people/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/photos/view/small"></img></div>\n<p>\n  <a href="tel:',u=n.telephone,u?o=u.call(t,{hash:{}}):(o=t.telephone,o=typeof o===a?o():o),s+=f(o)+'">',u=n.telephone,u?o=u.call(t,{hash:{}}):(o=t.telephone,o=typeof o===a?o():o),s+=f(o)+'</a>\n</p>\n<p>\n  <a href="mailto:',u=n.email,u?o=u.call(t,{hash:{}}):(o=t.email,o=typeof o===a?o():o),s+=f(o)+'">',o=t.email,u=n.formatEmail,o=u?u.call(t,o,{hash:{}}):l.call(t,"formatEmail",o,{hash:{}}),s+=f(o)+'</a>\n</p>\n<button class="btn btn-danger" href="#"><i class="icon-ban-circle icon-white"></i> ',u=n.t,o=u?u.call(t,"people.archive",{hash:{}}):l.call(t,"t","people.archive",{hash:{}}),s+=f(o)+" ",u=n.firstName,u?o=u.call(t,{hash:{}}):(o=t.firstName,o=typeof o===a?o():o),s+=f(o)+"</button>\n",s}),this.Templates["photos/empty"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="alert fade in">\n  <i class="icon-exclamation-sign"></i> ',u=n.t,o=u?u.call(t,"photos.not_found","capitalize",{hash:{}}):a.call(t,"t","photos.not_found","capitalize",{hash:{}}),s+=f(o)+"\n</div>\n",s}),this.Templates["photos/item"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<div class="image caption-bottom">\n  <img src="/api/photos/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/view/small"></img>\n  <a class="default" href="#">&nbsp;</a>\n  <a class="delete" href="#">&nbsp;</a>\n  <figcaption>',u=n.caption,u?o=u.call(t,{hash:{}}):(o=t.caption,o=typeof o===a?o():o),s+=f(o)+"</figcaption>\n</div>\n",s}),this.Templates["photos/upload"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression;return s+="<fieldset>\n  ",o={},o.field="caption",u=t.caption,o.value=u,o.width=4,o.label="photos.caption",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n  ",o={},o.field="file",o.width=4,o.label="photos.image",a=n.include,o=a?a.call(t,"file",{hash:o}):f.call(t,"include","file",{hash:o}),s+=l(o)+"\n  ",o={},o.icon="upload",o.loading="general.uploading",o.text="photos.upload",a=n.include,o=a?a.call(t,"button",{hash:o}):f.call(t,"include","button",{hash:o}),s+=l(o)+"\n</fieldset>\n",s}),this.Templates["security/register"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\n  <h3><small><i class="icon-user"></i></small>&nbsp;',u=n.t,o=u?u.call(t,"security.register",{hash:{}}):a.call(t,"t","security.register",{hash:{}}),s+=f(o)+" <small>",u=n.t,o=u?u.call(t,"security.enter_credentials",{hash:{}}):a.call(t,"t","security.enter_credentials",{hash:{}}),s+=f(o)+' &rarr;</small></h3>\n</div>\n\n<div class="modal-body">\n  <form>\n    <fieldset>\n      <span class="input-append">\n        <input type="text" placeholder="',u=n.t,o=u?u.call(t,"security.user_or_email",{hash:{}}):a.call(t,"t","security.user_or_email",{hash:{}}),s+=f(o)+'" name="username" id="username" class="span3">\n        <span class="add-on"><i class="icon-user"></i></span>\n      </span>\n      <span class="input-append" style="margin-left: 10px">\n        <input type="password" placeholder="',u=n.t,o=u?u.call(t,"security.password",{hash:{}}):a.call(t,"t","security.password",{hash:{}}),s+=f(o)+'" name="password" id="password" class="span2">\n        <span class="add-on"><i class="icon-lock"></i></span>\n      </span>\n    </fieldset> \n  </form>\n\n  <div class="alert alert-error hide"></div>\n\n</div>\n\n<div class="modal-footer" style="text-align: left">\n  <button class="btn btn-success" id="signon"><i class="icon-lock icon-white"></i>&nbsp;&nbsp;',u=n.t,o=u?u.call(t,"security.register",{hash:{}}):a.call(t,"t","security.register",{hash:{}}),s+=f(o)+' &rarr;</button>\n  <button class="btn btn-link" data-dismiss="modal" aria-hidden="true">',u=n.t,o=u?u.call(t,"general.cancel","lower",{hash:{}}):a.call(t,"t","general.cancel","lower",{hash:{}}),s+=f(o)+"</button>\n</div>\n",s}),this.Templates["security/signedon"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function";return s+='<ul class="nav">\n	<li class="active"><a href="#profile"><span class="mute">',u=n.t,o=u?u.call(t,"security.signed_on",{hash:{}}):a.call(t,"t","security.signed_on",{hash:{}}),s+=f(o)+"</span> ",u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===l?o():o),s+=f(o)+'</a></li>\n	<li><a href="#switch">',u=n.t,o=u?u.call(t,"security.switch","lower",{hash:{}}):a.call(t,"t","security.switch","lower",{hash:{}}),s+=f(o)+'</a>\n	<li><a href="#signout" class="signout">',u=n.t,o=u?u.call(t,"security.signout","lower",{hash:{}}):a.call(t,"t","security.signout","lower",{hash:{}}),s+=f(o)+"</a>\n</ul>\n",s}),this.Templates["security/signedout"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<ul class="nav">\n	<li class="active"><a href="#signon" class="signon">',u=n.t,o=u?u.call(t,"security.signon","lower",{hash:{}}):a.call(t,"t","security.signon","lower",{hash:{}}),s+=f(o)+'</a></li>\n	<li><a href="#register" class="register">',u=n.t,o=u?u.call(t,"security.register","lower",{hash:{}}):a.call(t,"t","security.register","lower",{hash:{}}),s+=f(o)+"</a>\n</ul>\n",s}),this.Templates["security/signon"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\n  <h3><small><i class="icon-lock"></i></small>&nbsp;',u=n.t,o=u?u.call(t,"security.signon",{hash:{}}):a.call(t,"t","security.signon",{hash:{}}),s+=f(o)+" <small>",u=n.t,o=u?u.call(t,"security.enter_credentials",{hash:{}}):a.call(t,"t","security.enter_credentials",{hash:{}}),s+=f(o)+' &rarr;</small></h3>\n</div>\n\n<div class="modal-body">\n	<form>\n	  <fieldset>\n      <label for="code">',u=n.t,o=u?u.call(t,"security.organisation_code",{hash:{}}):a.call(t,"t","security.organisation_code",{hash:{}}),s+=f(o)+'</label>\n      <div class="input-prepend">\n        <span class="add-on"><i class="icon-globe"></i></span>\n        <input type="text" name="code" id="code" class="span2">\n      </div>\n      <label for="name">',u=n.t,o=u?u.call(t,"security.user_or_email",{hash:{}}):a.call(t,"t","security.user_or_email",{hash:{}}),s+=f(o)+'</label>\n      <div class="input-prepend">\n        <span class="add-on"><i class="icon-user"></i></span>\n        <input type="text" name="name" id="name" class="span4">\n      </div>\n      <label for="password">',u=n.t,o=u?u.call(t,"security.password",{hash:{}}):a.call(t,"t","security.password",{hash:{}}),s+=f(o)+'</label>\n			<div class="input-prepend">\n        <span class="add-on"><i class="icon-lock"></i></span>\n    		<input type="password" name="password" id="password" class="span4">\n			</div>\n	  </fieldset>	\n	</form>\n\n	<div class="alert alert-error hide"></div>\n\n  <div>\n  	<button class="btn btn-primary" id="facebook"><i class="icon-facebook icon-white"></i>&nbsp;&nbsp;Facebook</button>\n  	<button class="btn btn-info" id="twitter"><i class="icon-twitter icon-white"></i>&nbsp;&nbsp;Twitter</button>\n  </div>\n</div>\n\n<div class="modal-footer" style="text-align: left">\n  <button class="btn btn-success" id="signon"><i class="icon-lock icon-white" data-loading-text="',u=n.t,o=u?u.call(t,"security.signing_on",{hash:{}}):a.call(t,"t","security.signing_on",{hash:{}}),s+=f(o)+'..."></i>&nbsp;&nbsp;',u=n.t,o=u?u.call(t,"security.signon",{hash:{}}):a.call(t,"t","security.signon",{hash:{}}),s+=f(o)+' &rarr;</button>\n  <button class="btn btn-link" data-dismiss="modal" aria-hidden="true">',u=n.t,o=u?u.call(t,"general.cancel","lower",{hash:{}}):a.call(t,"t","general.cancel","lower",{hash:{}}),s+=f(o)+"</button>\n</div>\n",s}),this.Templates["support/layout"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<div id="pages">\n  <header id="top"></header>\n\n  <div id="page">\n    <div id="sidebar" class="auto-height">\n      <div id="summary"></div>\n    </div>\n\n    <section>\n      <div id="content" class="auto-height">\n        <div id="menu"></div>\n\n        <div id="message"></div>\n\n        <div id="inner"></div>\n\n        <aside id="aside" class="auto-height"></aside>\n      </div>\n    </section>\n\n  </div>\n</div>\n'}),this.Templates["support/navigation"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<h1>",u=n.t,o=u?u.call(t,"main.support",{hash:{}}):a.call(t,"t","main.support",{hash:{}}),s+=f(o)+'</h1>\n\n<ul class="nav nav-pills">\n</ul>\n',s}),this.Templates["administration/organisations/roles/add"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression;return s+="<fieldset>\n  ",o={},o.field="name",u=t.name,o.value=u,o.width=4,o.required=!0,o.label="organisations.role_name",a=n.include,o=a?a.call(t,"input",{hash:o}):f.call(t,"include","input",{hash:o}),s+=l(o)+"\n  ",o={},o.icon="user",o.loading="general.saving",o.text="organisations.add_role",a=n.include,o=a?a.call(t,"button",{hash:o}):f.call(t,"include","button",{hash:o}),s+=l(o)+"\n</fieldset>\n",s}),this.Templates["administration/organisations/roles/empty"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="alert fade in">\n  <i class="icon-exclamation-sign"></i> ',u=n.t,o=u?u.call(t,"organisations.no_roles","capitalize",{hash:{}}):a.call(t,"t","organisations.no_roles","capitalize",{hash:{}}),s+=f(o)+"\n</div>\n",s}),this.Templates["administration/organisations/roles/item"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<div class="accordion-heading">\n  <a class="accordion-toggle" data-toggle="collapse" data-parent="#roles" href="#',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'">\n    ',u=n.name,u?o=u.call(t,{hash:{}}):(o=t.name,o=typeof o===a?o():o),s+=f(o)+'\n  </a>\n</div>\n<div id="',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'" class="accordion-body collapse">\n  <div class="accordion-inner">\n    ',o=t.claims,o=o==null||o===!1?o:o.length,o=typeof o===a?o():o,s+=f(o)+"\n  </div>\n</div>\n",s}),this.Templates["administration/organisations/roles/roles"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<div class="accordian" id="roles"></div>'}),this.Templates["app/common/help"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<h4>",o=t.title,u=n.t,o=u?u.call(t,o,{hash:{}}):a.call(t,"t",o,{hash:{}}),s+=f(o)+"</h4>\n<p>",o=t.content,u=n.markdown,o=u?u.call(t,o,{hash:{}}):a.call(t,"markdown",o,{hash:{}}),s+=f(o)+"</p>",s}),this.Templates["app/common/page"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression;return s+='<li class="',u=n.className,u?o=u.call(t,{hash:{}}):(o=t.className,o=typeof o===a?o():o),s+=f(o)+'" ><a href="#" class="page">',u=n.number,u?o=u.call(t,{hash:{}}):(o=t.number,o=typeof o===a?o():o),s+=f(o)+"</a></li>",s}),this.Templates["app/common/paging"]=Handlebars.template(function(e,t,n,r,i){n=n||e.helpers;var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<li><a href="#" class="first" rel="tooltip" title="',u=n.t,o=u?u.call(t,"general.first",{hash:{}}):a.call(t,"t","general.first",{hash:{}}),s+=f(o)+'" data-placement="bottom">&laquo;</a></li>\n<li><a href="#" class="prev" rel="tooltip" title="',u=n.t,o=u?u.call(t,"general.previous",{hash:{}}):a.call(t,"t","general.previous",{hash:{}}),s+=f(o)+'" data-placement="bottom">&lsaquo;</a></li>\n<span class="pages"></span>\n<li><a href="#" class="next" rel="tooltip" title="',u=n.t,o=u?u.call(t,"general.next",{hash:{}}):a.call(t,"t","general.next",{hash:{}}),s+=f(o)+'" data-placement="bottom">&rsaquo;</a></li>\n<li><a href="#" class="last" rel="tooltip" title="',u=n.t,o=u?u.call(t,"general.last",{hash:{}}):a.call(t,"t","general.last",{hash:{}}),s+=f(o)+'" data-placement="bottom">&raquo;</a></li>\n',s}),this.Templates["app/layout/main"]=Handlebars.template(function(e,t,n,r,i){return n=n||e.helpers,'<header id="header"></header>\n\n<div id="main">\n  <nav id="primary"></nav>\n\n  <div id="contents"></div>\n</div>\n\n<div id="bg"></div>\n\n<div id="modal" class="modal hide fade"></div>\n'}),_.extend(Backbone.Validation.callbacks,{valid:function(e,t,n){var r=e.$("["+n+"="+t+"]"),i=r.parents(".control-group");r.data("error-style")==="tooltip"?r.data("tooltip")&&r.tooltip("hide"):r.data("error-style")==="inline"?i.find(".help-inline.error-message").remove():i.find(".help-block.error-message").remove(),i.removeClass("error")},invalid:function(e,t,n,r){var i=e.$("["+r+"="+t+"]"),s=i.parents(".control-group"),o=s.find("label").text().capitalize()+" "+i18n.t(n);s.addClass("error");if(i.data("error-style")==="tooltip"){var u=i.data("tooltip-position")||"right";i.tooltip({placement:u,trigger:"manual",animation:!1,title:o}),i.tooltip("show")}else if(i.data("error-style")==="inline"){s.find(".help-inline").length===0&&s.find("label").append("<span class='help-inline error-message'></span>");var a=s.find(".help-inline");a.text(o)}else{s.find(".help-block").length===0&&s.find(".controls").append("<p class='help-block error-message'></p>");var a=s.find(".help-block");a.text(o)}}}),Backbone.Marionette.Renderer.render=function(e,t){return Templates[e](t)},Proof=function(e,t,n){"use strict";var r=new t.Application;return r.on("initialize:after",function(){e.history&&e.history.start({pushState:!1,root:"/"})}),r.socket=io.connect(),r}(Backbone,Backbone.Marionette,_),$(function(){window.setTimeout(function(){$("#loading").hide(),Proof.start()},0)}),Proof.module("Common.Models",function(e,t,n,r,i,s,o){var u=function(e){var n=e;return t.Global.session&&(n=s.extend({headers:{Authorization:"Basic "+t.Global.session.authenticationToken()}},e)),n};e.SecuredCollection=o.clientPager.extend({sync:function(e,t,n){return this._super(e,t,u(n))},defaultErrorHandler:function(e,n){n.status===403&&t.vent.trigger("security:unauthorised",this)},paginator_ui:{perPage:10,pagesInRange:1},sort:function(e){var t="asc";e===this.sortColumn&&(t=this.sortDirection==="asc"?"desc":"asc"),this.setSort(e,t)},pages:function(){var e=function(e,t){if(e===t)return"active"},t=this,n=[];return this.information&&s.each(s.range(1,this.information.totalPages+1),function(r){n.push({number:r,className:e(t.currentPage,r)})}),n}}),e.SecuredModel=n.Model.extend({noIoBind:!1,socket:t.socket,setupIoBind:function(){s.bindAll(this,"serverChange","serverDelete","modelCleanup"),this.noIoBind||(this.ioBind("update",this.serverChange,this),this.ioBind("delete",this.serverDelete,this))},sync:function(e,t,n){return this._super(e,t,u(n))},defaultErrorHandler:function(e,n){n.status===403&&t.vent.trigger("security:unauthorised",this)},copyFrom:function(e){return e==null?!1:(this.set(e.attributes),!0)},serverChange:function(e){e.fromServer=!0,this.set(e)},serverDelete:function(e){this.modelCleanup()},modelCleanup:function(){return this.ioUnbindAll(),this}})},Backbone.Paginator),Proof.module("Common.Views",function(e,t,n,r,i,s){e.FormView=r.ItemView.extend({tagName:"form",className:"box",initialize:function(e){this.model.on("change",this.render,this)},events:{"keypress input":"onKeypress","change   input":"onChangeInput","change   select":"onChangeSelect","click    button#save":"onSave"},onRender:function(){this.delegateEvents(),this.ui.selects&&this.ui.selects.select2({minimumResultsForSearch:9999}),this.setFocus()},setFocus:function(){this.focus&&this.ui[this.focus].focus()},onKeypress:function(e){e.keyCode===13&&this.onChange(e)},onChangeInput:function(e){var t=e.currentTarget.id,n=this.ui[t],r=n.val();if(n.attr("type")==="file")return;this.onChange(t,n,r)},onChangeSelect:function(e){var t=e.currentTarget.id,n=this.ui[t],r=n.find(":selected").attr("id");this.onChange(t,n,r)},onChange:function(e,t,n){var r=this.model.get(e);this.model.off("change",this.render,this),this.model.set(e,n),this.model.isValid(!0)?this.autoSave&&this.save(function(t){t.set(e,n)},function(t){t.set(e,r)}):this.model.set(e,r),this.model.on("change",this.render,this)},onSave:function(e){e.preventDefault();var t=this.ui.save;this.model.isValid(!0)&&(console.log(t.html()),t.button("loading"),this.save(s(this.afterSave).bind(this),function(){t.button("reset")}))},save:function(e,n,r){var i=this.model,s=this.messages;return this.model.save().success(function(){e&&e(i),t.vent.trigger("message:clear")}).fail(function(){n&&n(i),t.vent.trigger("message:show",i18n.t("error."+s.error))}).always(function(){r&&r(i)}),!1}}),e.UploadView=e.FormView.extend({save:function(e,t){return this.model.setFile(this.ui.file),this._super(e,t)}})}),Proof.module("Security.Models",function(e,t,n,r,i,s){var o="anonymous",u="|",a=t.Common.Models.SecuredModel,f=t.Common.Models.SecuredCollection;e.SignOn=n.Model.extend({defaults:{name:o,sessionId:u},urlRoot:"/api/sessions",authenticationToken:function(){var e=this.get("name"),t=this.get("sessionId");return window.btoa([e,t].join(":"))},isAuthenticated:function(){return this.get("name")!==o}}),e.User=a.extend({urlRoot:"/api/users",initialize:function(e,t){e||(e={}),this.init&&this.init(t,e),this.on("change",this.setPerson,this),this.setupIoBind()},setPerson:function(){this.get("people")&&this.get("people").length&&this.set("person",s(this.get("people")).first())}}),e.Users=f.extend({url:"/api/users"})}),Proof.module("Security.Views",function(e,t,n,r,i,s){var o=t.Common.Views.FormView;e.RegisterView=r.ItemView.extend({template:"security/register",ui:{username:"input#username",password:"input#password",alert:".alert"},events:{"click    button#register":"register","keypress input#username":"onKeypress","keypress input#password":"onKeypress","change   input#username":"onChange","change   input#password":"onChange"},initialize:function(e){this.model=e.model},onRender:function(){t.vent.bindTo(t.vent,"modal:shown",this.setFocus,this)},setFocus:function(e){this.ui.username.focus()},onKeypress:function(e){e.keyCode===13&&(this.onChange(e),this.register())},onChange:function(e){var t=e.target.id,n=this.ui[t].val().trim();this.model.set(t,n)},register:function(e){},alert:function(e){this.ui.alert.text(e).hide().fadeIn()}})}),Proof.module("Security.Views",function(e,t,n,r,i,s){var o=t.Security.Models.SignOn,u=t.Security.Models.User,a=t.Security.Views.RegisterView;e.SignOnView=r.ItemView.extend({template:"security/signon",ui:{code:"input#code",name:"input#name",password:"input#password",alert:".alert"},events:{"click    button#signon":"signOn","keypress input":"onKeypress","change   input":"onChange"},onRender:function(){t.vent.bindTo(t.vent,"modal:shown",this.setFocus,this)},setFocus:function(e){this.ui.code.focus()},onKeypress:function(e){e.keyCode===13&&(this.onChange(e),this.signOn())},onChange:function(e){var t=e.target.id,n=this.ui[t].val().trim();this.model.set(t,n)},signOn:function(e){var n=this,r=this.model.save();r.done(function(e){t.vent.trigger("security:signon",new o(e)),n.close()}),r.fail(function(e){e.status===404||e.status===403?n.alert(i18n.t("error.security.invalid_credentials")):e.status===500&&n.alert(i18n.t("error.general.try_again")),n.setFocus()})},alert:function(e){this.ui.alert.text(e).hide().fadeIn()}}),e.SignedOnView=r.ItemView.extend({template:"security/signedon",events:{"click .signout":"signOut"},signOut:function(){return t.vent.trigger("security:signout"),!1}}),e.SignedOutView=r.ItemView.extend({template:"security/signedout",events:{"click .signon":"showSignOn","click .register":"showRegister"},showRegister:function(e){return this.modal(new a({model:new u}))},showSignOn:function(t){return this.modal(new e.SignOnView({model:new o}))},modal:function(e){return t.layout.modal.show(e),!1}})}),Proof.module("Security",function(e,t,n,r,i,s){var o=e.Views.Layout,u=e.Views.SidebarView;e.Router=r.AppRouter.extend({appRoutes:{profile:"profile"}}),e.Controller=r.Controller.extend({initialize:function(){},profile:function(){this.layout=new o({sidebar:new u}),this.layout.render(),t.layout.main.show(this.layout)}}),e.addInitializer(function(){e.router=new e.Router({controller:new e.Controller})})}),Proof.module("Models",function(e,t,n,r,i,s){e.Help=n.Model.extend({}),e.Message=n.Model.extend({defaults:{type:"error",yes:"general.yes",no:"general.no"},initialize:function(e,t){var n=e.type||this.defaults.type;this.set("icon",this.icon(n)),this.set("color",this.color(n)),this.set("heading",this.heading(n,e.heading)),this.init&&this.init(e,t)},icon:function(e){var t={error:"ban-circle",exclamation:"exclamation-sign",info:"info-sign",question:"info-question-sign"};return"icon-"+t[e]},isError:function(){return this.get("type")==="error"},isQuestion:function(){return this.get("type")==="question"},color:function(e){return e==="question"?"error":e},heading:function(e,t){if(t)return t;if(e==="question")return i18n.t("general.are_you_sure")}}),e.Messages=n.Collection.extend({model:e.Message,hasErrors:function(){return s(this.models).filter(function(e){return e.isError()}).length>0},clearNonErrors:function(){this.models=s(this.models).reject(function(e){return!e.isError()})}})}),Proof.module("Views",function(e,t,n,r,i,s){var o=r.Renderer,u=r.Region,a=t.Models.Help,f=t.Security.Views.SignedOnView,l=t.Security.Views.SignedOutView;e.ModalRegion=r.Region.extend({el:"#modal",constructor:function(){r.Region.prototype.constructor.apply(this,arguments),this.on("show",this.showModal,this)},getEl:function(e){var t=i(e);return t.on("hidden",this.close),t},showModal:function(e){e.on("close",this.hideModal,this),this.$el.modal("show").on("shown",function(){t.vent.trigger("modal:shown")})},hideModal:function(){this.$el.modal("hide")}}),e.HelpView=r.ItemView.extend({template:"app/common/help",initialize:function(e){var t=e.section;this.model=new a({title:"main."+t,content:"help:"+t})}}),e.MessageView=r.ItemView.extend({template:"app/message",ui:{alert:".alert",yes:"button.yes",no:"button.no"},initialize:function(){this.model.on("change",this.render,this),this.model.isQuestion()&&(this.template="app/question")},onRender:function(){var e=this.collection,t=this.model;this.ui.alert.bind("closed",function(){e.off("change"),e.remove(t)}),this.model.isQuestion()&&this.setupQuestion()},setupQuestion:function(){var e=this.ui.alert,t=this.model.get("confirm");this.ui.yes.bind("click",this.model.get("confirm")),this.ui.no.bind("click",function(){e.alert("close")})}}),e.MessageListView=r.CollectionView.extend({itemView:e.MessageView,itemViewOptions:function(){return{collection:this.collection}},initialize:function(){this.collection.on("change",this.render,this)}}),e.NavigationView=r.View.extend({template:"app/navigation",ui:{items:"ul li a"},initialize:function(){t.vent.on("section:changed",this.render,this)},render:function(){this.$el.html(o.render(this.template,this)),this.bindUIElements(),this.select(t.Global.section)},select:function(e){if(s.isUndefined(e))return;this.ui.items.removeClass("active").filter("."+e).addClass("active"),this.ui.items.tooltip({delay:{show:500,hide:100}})}}),e.LocaleView=r.View.extend({template:"app/locale",ui:{items:"ul li"},events:{"click .locale":"onChangeLocale"},render:function(){this.$el.html(o.render(this.template,this)),this.bindUIElements(),this.changeLocale(i18n.lng())},onChangeLocale:function(e){var n=i(e.currentTarget).data("locale");return t.vent.trigger("locale:change",n),!1},changeLocale:function(e){if(s.isUndefined(e))return;this.ui.items.removeClass("active").filter("."+e).addClass("active")}}),e.HeaderView=r.View.extend({template:"app/header",initialize:function(e){var n=this;e=e||{},this.locale=e.locale,this.security=new u({el:"#security"}),this.locale=new u({el:"#locale"}),t.vent.on("security:signedon",this.reload,this),t.vent.on("security:signedout",this.reload,this),t.vent.on("locale:changed",this.reload,this)},render:function(){this.$el.html(o.render(this.template,this))},reload:function(e,n){e=e||t.session,e&&e.isAuthenticated()?this.showSignedOn(e):e&&this.showSignedOut(),this.showLocale(),this.$el.find(".logo").text(i18n.translate("main.title"))},showSignedOut:function(){this.security.show(new l)},showSignedOn:function(e){this.security.show(new f({model:e}))},showLocale:function(){this.locale.show(new e.LocaleView)}}),e.Layout=r.Layout.extend({template:"app/layout/main",el:"body",regions:{header:"#header",main:"#contents",navigation:"nav#primary",modal:e.ModalRegion},initialize:function(e){e.header!=null&&(this.headerView=e.header),e.navigation!=null&&(this.navigationView=e.navigation)},onRender:function(){this.header.show(this.headerView),this.navigation.show(this.navigationView)}}),e.addInitializer(function(){t.layout=new e.Layout({header:new e.HeaderView,navigation:new e.NavigationView}),t.layout.render()})}),Proof.module("Views",function(e,t,n,r,i,s){e.PagingView=r.ItemView.extend({template:"app/common/paging",tagName:"ul",events:{"click a.page":"gotoPage","click a.first":"gotoFirst","click a.prev":"gotoPrev","click a.next":"gotoNext","click a.last":"gotoLast"},ui:{pages:".pages",first:"a.first",prev:"a.prev",next:"a.next",last:"a.last",all:"li"},onRender:function(){if(this.model.information==null)return;var e="",t=this.model;s.each(this.model.pages(),function(t){e+=r.Renderer.render("app/common/page",t)}),this.ui.pages.replaceWith(e),this.model.currentPage===1&&this.ui.prev.parent().addClass("disabled"),this.model.currentPage===this.model.information.lastPage&&this.ui.next.parent().addClass("disabled"),this.model.pages().length===1&&this.ui.all.addClass("disabled").removeClass("active"),(this.model.pages().length===0||this.model.information.totalRecords===1)&&this.$el.hide(),this.ui.all.filter("*[class!='disabled']").find("a").tooltip()},gotoFirst:function(e){e.preventDefault(),this.model.goTo(1)},gotoPrev:function(e){e.preventDefault(),this.model.previousPage()},gotoNext:function(e){e.preventDefault(),this.model.nextPage()},gotoLast:function(e){e.preventDefault(),this.model.goTo(this.model.information.lastPage)},gotoPage:function(e){e.preventDefault();var t=i(e.currentTarget).text();this.model.goTo(t)}})}),Proof.module("Home.Views",function(e,t,n,r,i,s){e.NavigationView=r.ItemView.extend({template:"home/navigation"}),e.SummaryView=r.ItemView.extend({template:"home/summary"}),e.Layout=r.Layout.extend({template:"home/layout",regions:{navigation:"#top",aside:"#aside",summary:"#summary",menu:"#menu",inner:"#inner"},initialize:function(e){e.aside!=null&&(this.asideView=e.aside),e.navigation!=null&&(this.navigationView=e.navigation),e.summary!=null&&(this.summaryView=e.summary)},onRender:function(){this.aside.show(this.asideView),this.navigation.show(this.navigationView),this.summaryView!=null&&this.summary.show(this.summaryView)}})}),Proof.module("Home",function(e,t,n,r,i,s){var o=t.Views.HelpView,u=e.Views.Layout,a=e.Views.NavigationView,f=e.Views.SummaryView;e.Router=r.AppRouter.extend({appRoutes:{"":"index",home:"index"}}),e.Controller=r.Controller.extend({selectMenu:function(){t.vent.trigger("section:change","home")},index:function(){this.selectMenu(),this.layout=new u({aside:new o({section:"home"}),navigation:new a,summary:new f({model:t.Global.currentUser})}),this.layout.render(),t.layout.main.show(this.layout)}}),e.addInitializer(function(){e.router=new e.Router({controller:new e.Controller})})}),Proof.module("Support.Views",function(e,t,n,r,i,s){e.NavigationView=r.ItemView.extend({template:"support/navigation"}),e.Layout=r.Layout.extend({template:"support/layout",regions:{navigation:"#top",aside:"#aside",summary:"#summary",menu:"#menu",inner:"#inner"},initialize:function(e){e.aside!=null&&(this.asideView=e.aside),e.navigation!=null&&(this.navigationView=e.navigation)},onRender:function(){this.aside.show(this.asideView),this.navigation.show(this.navigationView)}})}),Proof.module("Support",function(e,t,n,r,i,s){var o=t.Views.HelpView,u=e.Views.Layout,a=e.Views.NavigationView;e.Router=r.AppRouter.extend({appRoutes:{support:"index"}}),e.Controller=r.Controller.extend({selectMenu:function(){t.vent.trigger("section:change","support")},index:function(){this.selectMenu(),this.layout=new u({aside:new o({section:"support"}),navigation:new a}),this.layout.render(),t.layout.main.show(this.layout)}}),e.addInitializer(function(){e.router=new e.Router({controller:new e.Controller})})}),Proof.module("Photos.Models",function(e,t,n,r,i,s){var o=t.Common.Models.SecuredCollection,u=t.Common.Models.SecuredModel;e.Photo=u.extend({urlRoot:function(){return"/api/"+this.parent.name+"/"+this.parent.id+"/photos"},sync:function(e,t,n){var r=this;return e==="create"&&(n.iframe=!0,n.files=this.file,n.data={owner:this.get("owner"),caption:this.get("caption")}),this._super(e,t,n)},setFile:function(e){this.file=e}}),e.Photos=o.extend({model:e.Photo,initialize:function(e,t){t||(t={}),this.bind("error",this.defaultErrorHandler,this),this.init&&this.init(e,t),this.parent=t.parent,this.on("add",this.setParent,this),this.on("reset",function(){s(this.models).each(s.bind(this.setParent,this))},this)},setParent:function(e){e.parent=this.parent},paginator_core:{dataType:"json",url:function(){return"/api/"+this.parent.name+"/"+this.parent.id+"/photos"}}})}),Proof.module("Photos.Views",function(e,t,n,r,i,s){var o=t.Common.Views.FormView,u=t.Common.Views.UploadView;e.ItemView=r.ItemView.extend({template:"photos/item",tagName:"figure",className:"photo",events:{"click a.delete":"onDelete","click a.default":"onDefault"},onDelete:function(e){e.preventDefault();var n=s.bind(function(){this.model.destroy(),t.vent.trigger("message:clear"),t.vent.trigger("message:show",{type:"info",text:i18n.t("photos.deleted")})},this);t.vent.trigger("message:clear"),t.vent.trigger("message:show",{type:"question",text:i18n.t("photos.delete"),confirm:n})},onDefault:function(e){e.preventDefault()}}),e.EmptyView=r.ItemView.extend({template:"photos/empty"}),e.ListView=r.CollectionView.extend({itemView:e.ItemView,emptyView:e.EmptyView,initialize:function(){this.collection.bind("change",this.render,this.collection),this.collection.bind("reset",this.render,this.collection)}}),e.UploadView=u.extend({template:"photos/upload",ui:{caption:"input#caption",file:"input#file",save:"button#save"},messages:{error:"photos.upload"},initialize:function(e){this.autoSave=!1,this.focus="caption",this.section=e.section,console.log(this.section,e)},onRender:function(){return this.ui.file.customiseFileInput(),this._super()},afterSave:function(e){t.vent.trigger(this.section+":navigate","photos",this.section+"/"+e.get("owner")+"/photos")}})}),Proof.module("Administration",function(e,t,n,r,i,s){}),Proof.module("Administration.Organisations.Models",function(e,t,n,r,i,s,o){var u=t.Common.Models.SecuredCollection,a=t.Common.Models.SecuredModel,f=t.Photos.Models.Photos;e.Organisation=a.extend({urlRoot:"/api/organisations",defaults:{code:"...",photos:[],roles:[]},initialize:function(t,n){n||(n={}),this.init&&this.init(t,n);var r={parent:{id:this.get("id"),name:"organisations"}};this.photos=new f(this.get("photos"),r),this.roles=new e.Roles(this.get("roles"),r)},markActive:function(){this.set("active","active")},isActive:function(){return this.get("active")==="active"},addRole:function(){var t=new e.Role({organisation:this.get("id")});return this.roles.add(t),t},validation:{description:{required:!0,msg:"validation.required"},code:{required:!0,msg:"validation.required"},code:{pattern:"number",msg:"validation.invalid"}}}),e.Organisations=u.extend({model:e.Organisation,initialize:function(e,t){t||(t={}),this.bind("error",this.defaultErrorHandler,this),this.bind("reset",function(){this.setPage(this.page)},this),this.init&&this.init(e,t)},clearActive:function(){s.each(this.origModels,function(e){e.set("active","")})},markActive:function(e){s.invoke(s.filter(this.origModels,function(t){return t.get("id")===e}),"markActive")},active:function(){var e=s.filter(this.origModels,function(e){return e.isActive()});if(e.length>0)return s(e).first()},setPage:function(e){this.page=e,s.each(this.origModels,function(t){t.set("page",e)})},filter:function(e){this.setFilter(["description"],e),this.pager()},paginator_core:{dataType:"json",url:"/api/organisations"}}),e.Role=a.extend({urlRoot:function(){return"/api/"+this.parent.name+"/"+this.parent.id+"/roles"},validation:{name:{required:!0,msg:"validation.required"}}}),e.Roles=u.extend({model:e.Role,initialize:function(e,t){t||(t={}),this.bind("error",this.defaultErrorHandler,this),this.init&&this.init(e,t),this.parent=t.parent,this.on("add",this.setParent,this),this.on("reset",function(){s(this.models).each(s.bind(this.setParent,this))},this)},setParent:function(e){e.parent=this.parent},paginator_core:{dataType:"json",url:function(){return"/api/"+this.parent.name+"/"+this.parent.id+"/roles"}}})},Backbone.Paginator),Proof.module("Administration.Organisations.Views",function(e,t,n,r,i,s){var o=t.Views.PagingView,u=r.Region,a=t.Common.Views.FormView;e.InfoView=a.extend({template:"administration/organisations/info",ui:{description:"input#description",code:"input#code"},messages:{error:"organisations.info"},initialize:function(){this.autoSave=!0,this.model.on("change",this.render,this)}}),e.SummaryView=r.ItemView.extend({template:"administration/organisations/summary",initialize:function(e){this.model.on("change",this.render,this)},onRender:function(){this.$(".image img").fallback({fallback:"/img/noprofile.png"})}}),e.FilterView=r.ItemView.extend({template:"administration/organisations/filter",ui:{filter:"input#search",refresh:"button.refresh",sort:"a.sort"},events:{"click button.refresh":"onRefresh","keyup input#search":"onFilter","click a.sort":"onSort"},onRender:function(){this.delegateEvents(),this.setSort("asc")},setSort:function(e){this.ui.sort.find("small").remove();var t="icon-caret-"+(e==="asc"?"up":"down");this.ui.sort.filter("[data-sort='"+(this.collection.sortColumn||"firstName")+"']").append(i("<small>&nbsp;<i class='icon "+t+"'></i></small>"))},onFilter:function(e){this.collection.filter(this.ui.filter.val());if(this.collection.length===1&&this.model!==this.collection.first()){var n=this.collection.first();this.collection.clearActive(),n.markActive(),t.vent.trigger("organisations:selected",n)}},onRefresh:function(e){e.preventDefault(),this.ui.filter.val(""),this.collection.filter("")},onSort:function(e){e.preventDefault(),this.collection.sort(i(e.currentTarget).data("sort")),this.setSort(this.collection.sortDirection)}}),e.MenuView=r.ItemView.extend({template:"administration/organisations/menu",ui:{links:"a",name:"a.brand"},events:{"click a":"onNavigate"},initialize:function(e){this.page=e.page,this.model&&this.model.on("change",this.render,this)},onRender:function(){this.delegateEvents(),this.select(this.page),t.vent.on("organisations:navigate",function(e){this.select(e)},this)},select:function(e){this.page=e,this.model?(this.ui.links.parent().removeClass("active"),this.ui.links.filter("[data-page='"+this.page+"']").parent().addClass("active")):(this.ui.links.attr("href","").parent().removeClass("active").addClass("disabled"),this.ui.name.hide())},onNavigate:function(e){e.preventDefault();if(this.model==null)return!1;var n=i(e.currentTarget).data("page"),r=i(e.currentTarget).attr("href");this.select(n),t.vent.trigger("organisations:navigate",n,r)}}),e.ItemView=r.ItemView.extend({tagName:"li",template:"administration/organisations/item",events:{"click .item":"onSelect"},initialize:function(e){this.model.on("change",this.render,this)},onSelect:function(e){e.preventDefault(),this.collection.clearActive(),this.model.markActive();var n=i(e.currentTarget),r=n.attr("href"),s=n.data("id"),o=n.data("page");t.vent.trigger("organisations:selected",this.collection.get(s),o,r)}}),e.NoItemsView=r.ItemView.extend({template:"administration/organisations/empty"}),e.SelectorView=r.CompositeView.extend({template:"administration/organisations/selector",itemViewContainer:"ul.list",itemView:e.ItemView,emptyView:e.NoItemsView,ui:{pagination:"div.pagination",list:"ul.list"},itemViewOptions:function(e){return{collection:this.collection}},initialize:function(e){this.collection.setPage(e.page),t.vent.on("organisations:navigate",this.collection.setPage,this.collection),this.collection.on("reset",this.render,this),this.collection.on("change",this.render,this)},onRender:function(){this.showPagination(),this.padList()},showPagination:function(){this.pagination&&this.pagination.reset(),this.pagination=new u({el:".pagination"}),this.pagination.show(new o({model:this.collection}))},padList:function(){if(this.collection.length>0&&this.collection.length<10)for(var e=0;e<10-this.collection.length;e++)this.ui.list.append("<li class='empty'><a>&nbsp;</a></li>")}}),e.Layout=r.Layout.extend({template:"administration/organisations/layout",regions:{filter:"#filter",aside:"#aside",selector:"#selector",menu:"#menu",inner:"#inner"},initialize:function(e){e.aside!=null&&(this.asideView=e.aside),e.filter!=null&&(this.filterView=e.filter),e.selector!=null&&(this.selectorView=e.selector),e.menu!=null&&(this.menuView=e.menu),e.inner!=null&&(this.innerView=e.inner)},onRender:function(){this.aside.show(this.asideView),this.filter.show(this.filterView),this.selector.show(this.selectorView),this.menuView&&this.menu.show(this.menuView),this.innerView&&this.inner.show(this.innerView)}})}),Proof.module("Administration.Organisations.Views",function(e,t,n,r,i,s){var o=t.Common.Views.FormView;e.RoleItemView=r.ItemView.extend({template:"administration/organisations/roles/item",className:"accordion-group",events:{}}),e.EmptyRolesView=r.ItemView.extend({template:"administration/organisations/roles/empty"}),e.SecurityView=r.CompositeView.extend({template:"administration/organisations/roles/roles",itemViewContainer:"div.accordian",itemView:e.RoleItemView,emptyView:e.EmptyRolesView,initialize:function(){this.collection.bind("change",this.render,this.collection),this.collection.bind("reset",this.render,this.collection)}}),e.AddRoleView=o.extend({template:"administration/organisations/roles/add",ui:{name:"input#name",save:"button#save"},messages:{error:"organisations.role"},initialize:function(){this.autoSave=!1,this.focus="name"},afterSave:function(e){t.vent.trigger("organisations:navigate","security","administration/organisations/"+e.get("organisation")+"/security")}})}),Proof.module("Administration.Organisations",function(e,t,n,r,i,s){var o="administration",u=e.Models.Organisations,a=e.Models.Organisation,f=t.Views.HelpView,l=e.Views.MenuView,c=e.Views.SelectorView,h=e.Views.FilterView,p=e.Views.SummaryView,d=e.Views.InfoView,v=e.Views.AddRoleView,m=e.Views.SecurityView,g=t.Photos.Views.ListView,y=e.Views.Layout;e.Router=r.AppRouter.extend({appRoutes:{administration:"index","administration/organisations":"index","administration/organisations/search/:q":"search","administration/organisations/new":"new","administration/organisations/:id":"show","administration/organisations/:id/":"show","administration/organisations/:id/info":"show","administration/organisations/:id/photos":"photos","administration/organisations/:id/photos/new":"show","administration/organisations/:id/documents":"show","administration/organisations/:id/documents/new":"show","administration/organisations/:id/security":"security","administration/organisations/:id/role":"role"}}),e.Controller=r.Controller.extend({selectMenu:function(){t.vent.trigger("section:change",o)},reset:function(){this.organisations=new u,this.organisation=null,t.vent.on("security:signedout",this.reset,this),t.vent.on("security:unauthorised",this.reset,this)},initialize:function(){this.reset(),t.vent.on("organisations:selected",this.selectOrganisation,this),t.vent.on("organisations:navigate",this.selectOrganisationPage,this)},index:function(){var n=this;this.selectMenu(),this.organisation=null,this.organisations.fetch().success(function(){n.organisations.setSort("description","asc"),n.organisations.goTo(1)});var r=this.organisations.active();r?e.router.navigate("administration/organisations/"+r.get("id"),!0):(this.constructLayout(new f({section:o}),new l({model:this.organisation,page:""})),t.vent.trigger("message:show",{type:"info",text:i18n.t("organisations.not_selected")}))},show:function(e){this.constructOrganisationLayout(e,"info")},search:function(e){},"new":function(){this.index()},photos:function(e){this.constructOrganisationLayout(e,"photos")},security:function(e){this.constructOrganisationLayout(e,"security")},role:function(e){this.constructOrganisationLayout(e,"role")},loadOrganisation:function(e){var t=this,n=!1;this.organisation=new a({id:e}),this.organisations.fetch().success(function(){t.organisations.setSort("description","asc"),t.organisations.goTo(1),n=t.organisation.copyFrom(t.organisations.get(e));while(!n)t.organisations.nextPage(),n=t.organisation.copyFrom(t.organisations.get(e));t.organisation.markActive(),t.organisations.markActive(t.organisation.get("id"))})},constructOrganisationLayout:function(e,t){this.selectMenu(),this.loadOrganisation(e),this.constructLayout(new p({model:this.organisation}),new l({model:this.organisation,page:t}),this.getOrganisationView(t),t)},constructLayout:function(e,n,r,i){var s=new h({collection:this.organisations,model:this.organisation}),o=new c({collection:this.organisations,page:i});t.vent.trigger("message:clear"),this.layout=new y({aside:e,filter:s,selector:o,menu:n,inner:r}),this.layout.render(),t.layout.main.show(this.layout)},selectOrganisation:function(n,r,i){if(this.layout==null)return;e.router.navigate(i,!1),t.vent.trigger("message:clear"),this.organisation=n,this.layout.filter.currentView.model=this.organisation,this.layout.menu.show(new l({model:this.organisation,page:r||"info"})),this.layout.aside.show(new p({model:this.organisation})),this.layout.inner.show(this.getOrganisationView(r))},selectOrganisationPage:function(n,r){if(this.layout==null)return;e.router.navigate(r,!1),t.vent.trigger("message:clear"),this.layout.inner.show(this.getOrganisationView(n))},getOrganisationView:function(e){switch(e){case"security":return this.organisation.roles.fetch(),new m({collection:this.organisation.roles});case"documents":break;case"role":var t=new v({model:this.organisation.addRole()});return n.Validation.bind(t),t;case"photos":return this.organisation.photos.fetch(),new g({collection:this.organisation.photos});case"info":default:var t=new d({model:this.organisation});return n.Validation.bind(t),t}}}),e.addInitializer(function(){e.router=new e.Router({controller:new e.Controller})})}),Proof.module("People.Models",function(e,t,n,r,i,s,o){var u=t.Common.Models.SecuredCollection,a=t.Common.Models.SecuredModel,f=t.Photos.Models.Photo,l=t.Photos.Models.Photos;e.Person=a.extend({urlRoot:"/api/people",defaults:{firstName:"...",photos:[],documents:[]},initialize:function(e,t){t||(t={}),this.init&&this.init(e,t);var n={parent:{id:this.get("id"),name:"people"}};this.photos=new l(this.get("photos"),n),this.setupIoBind()},addPhoto:function(){var e=new f({owner:this.get("id")});return this.photos.add(e),e},markActive:function(){this.set("active","active")},isActive:function(){return this.get("active")==="active"},validation:{firstName:{required:!0,msg:"validation.required"},lastName:{required:!0,msg:"validation.required"},email:{required:!1,pattern:"email",msg:"validation.invalid"}}}),e.People=u.extend({model:e.Person,initialize:function(e,t){t||(t={}),this.bind("error",this.defaultErrorHandler,this),this.bind("reset",function(){this.setPage(this.page)},this),this.init&&this.init(e,t)},clearActive:function(){s.each(this.origModels,function(e){e.set("active","")})},markActive:function(e){s.invoke(s.filter(this.origModels,function(t){return t.get("id")===e}),"markActive")},active:function(){var e=s.filter(this.origModels,function(e){return e.isActive()});if(e.length>0)return s(e).first()},setPage:function(e){this.page=e,s.each(this.origModels,function(t){t.set("page",e)})},filter:function(e){this.setFilter(["firstName","lastName"],e),this.pager()},paginator_core:{type:"GET",dataType:"json",url:"/api/people"}})},Backbone.Paginator),Proof.module("People.Views",function(e,t,n,r,i,s){var o=t.Views.PagingView,u=r.Region,a=t.Common.Views.FormView;e.InfoView=a.extend({template:"people/info",ui:{firstName:"input#firstName",lastName:"input#lastName",telephone:"input#telephone",email:"input#email",gender:"select#gender",title:"select#title",selects:"select"},messages:{error:"people.info"},initialize:function(){this.autoSave=!0,this.model.on("change",this.render,this)}}),e.SummaryView=r.ItemView.extend({template:"people/summary",initialize:function(e){this.model.on("change",this.render,this)},onRender:function(){this.$(".image img").fallback({fallback:"/img/noprofile.png"})}}),e.FilterView=r.ItemView.extend({template:"people/filter",ui:{filter:"input#search",refresh:"button.refresh",sort:"a.sort"},events:{"click button.refresh":"onRefresh","keyup input#search":"onFilter","click a.sort":"onSort"},onRender:function(){this.delegateEvents(),this.setSort("asc")},setSort:function(e){this.ui.sort.find("small").remove();var t="icon-caret-"+(e==="asc"?"up":"down");this.ui.sort.filter("[data-sort='"+(this.collection.sortColumn||"firstName")+"']").append(i("<small>&nbsp;<i class='icon "+t+"'></i></small>"))},onFilter:function(e){this.collection.filter(this.ui.filter.val());if(this.collection.length===1&&this.model!==this.collection.first()){var n=this.collection.first();this.collection.clearActive(),n.markActive(),t.vent.trigger("people:selected",n)}},onRefresh:function(e){e.preventDefault(),this.ui.filter.val(""),this.collection.filter("")},onSort:function(e){e.preventDefault(),this.collection.sort(i(e.currentTarget).data("sort")),this.setSort(this.collection.sortDirection)}}),e.MenuView=r.ItemView.extend({template:"people/menu",ui:{links:"a",name:"a.brand"},events:{"click a":"onNavigate"},initialize:function(e){this.page=e.page,this.model&&this.model.on("change",this.render,this)},onRender:function(){this.delegateEvents(),this.select(this.page),t.vent.on("people:navigate",function(e){this.select(e)},this)},select:function(e){this.page=e,this.model?(this.ui.links.parent().removeClass("active"),this.ui.links.filter("[data-page='"+this.page+"']").parent().addClass("active")):(this.ui.links.attr("href","").parent().removeClass("active").addClass("disabled"),this.ui.name.hide())},onNavigate:function(e){e.preventDefault();if(this.model==null)return!1;var n=i(e.currentTarget).data("page"),r=i(e.currentTarget).attr("href");this.select(n),t.vent.trigger("people:navigate",n,r)}}),e.ItemView=r.ItemView.extend({tagName:"li",template:"people/item",events:{"click .item":"onSelect"},initialize:function(e){this.model.on("change",this.render,this)},onSelect:function(e){e.preventDefault(),this.collection.clearActive(),this.model.markActive();var n=i(e.currentTarget),r=n.attr("href"),s=n.data("id"),o=n.data("page");t.vent.trigger("people:selected",this.collection.get(s),o,r)}}),e.NoItemsView=r.ItemView.extend({template:"people/empty"}),e.SelectorView=r.CompositeView.extend({template:"people/selector",itemViewContainer:"ul.list",itemView:e.ItemView,emptyView:e.NoItemsView,ui:{pagination:"div.pagination",list:"ul.list"},itemViewOptions:function(e){return{collection:this.collection}},initialize:function(e){this.collection.setPage(e.page),t.vent.on("people:navigate",this.collection.setPage,this.collection),this.collection.on("reset",this.render,this),this.collection.on("change",this.render,this)},onRender:function(){this.showPagination(),this.padList()},showPagination:function(){this.pagination&&this.pagination.reset(),this.pagination=new u({el:".pagination"}),this.pagination.show(new o({model:this.collection}))},padList:function(){if(this.collection.length>0&&this.collection.length<10)for(var e=0;e<10-this.collection.length;e++)this.ui.list.append("<li class='empty'><a>&nbsp;</a></li>")}}),e.Layout=r.Layout.extend({template:"people/layout",regions:{filter:"#filter",aside:"#aside",selector:"#selector",menu:"#menu",inner:"#inner"},initialize:function(e){e.aside!=null&&(this.asideView=e.aside),e.filter!=null&&(this.filterView=e.filter),e.selector!=null&&(this.selectorView=e.selector),e.menu!=null&&(this.menuView=e.menu),e.inner!=null&&(this.innerView=e.inner)},onRender:function(){this.aside.show(this.asideView),this.filter.show(this.filterView),this.selector.show(this.selectorView),this.menuView&&this.menu.show(this.menuView),this.innerView&&this.inner.show(this.innerView)}})}),Proof.module("People",function(e,t,n,r,i,s){var o=e.Models.People,u=e.Models.Person,a=t.Views.HelpView,f=e.Views.MenuView,l=e.Views.SelectorView,c=e.Views.FilterView,h=e.Views.SummaryView,p=e.Views.InfoView,d=t.Photos.Views.ListView,v=t.Photos.Views.UploadView,m=e.Views.Layout;e.Router=r.AppRouter.extend({appRoutes:{people:"index","people/search/:q":"search","people/new":"new","people/:id":"show","people/:id/":"show","people/:id/info":"show","people/:id/photos":"photos","people/:id/photo":"photo","people/:id/documents":"show","people/:id/document":"document","people/:id/permissions":"show"}}),e.Controller=r.Controller.extend({selectMenu:function(){t.vent.trigger("section:change","people")},reset:function(){this.people=new o,this.person=null,t.vent.on("security:signedout",this.reset,this),t.vent.on("security:unauthorised",this.reset,this)},initialize:function(){this.reset(),t.vent.on("people:selected",this.selectPerson,this),t.vent.on("people:navigate",this.selectPersonPage,this)},index:function(){var n=this;this.selectMenu(),this.person=null,this.people.fetch().success(function(){n.people.setSort("firstName","asc"),n.people.goTo(1)});var r=this.people.active();r?e.router.navigate("people/"+r.get("id"),!0):(this.constructLayout(new a({section:"people"}),new f({model:this.person,page:""})),t.vent.trigger("message:show",{type:"info",text:i18n.t("people.not_selected")}))},show:function(e){this.constructPersonLayout(e,"info")},search:function(e){},"new":function(){this.index()},photos:function(e){this.constructPersonLayout(e,"photos")},photo:function(e){this.constructPersonLayout(e,"photo")},documents:function(e){this.constructPersonLayout(e,"documents")},document:function(e){this.constructPersonLayout(e,"document")},loadPerson:function(e){var t=this,n=!1;this.person=new u({id:e}),this.people.fetch().success(function(){t.people.setSort("firstName","asc"),t.people.goTo(1),n=t.person.copyFrom(t.people.get(e));while(!n)t.people.nextPage(),n=t.person.copyFrom(t.people.get(e));t.person.markActive(),t.people.markActive(t.person.get("id"))})},constructPersonLayout:function(e,t){this.selectMenu(),this.loadPerson(e),this.constructLayout(new h({model:this.person}),new f({model:this.person,page:t}),this.getPersonView(t),t)},constructLayout:function(e,n,r,i){var s=new c({collection:this.people,model:this.person}),o=new l({collection:this.people,page:i});t.vent.trigger("message:clear"),this.layout=new m({aside:e,filter:s,selector:o,menu:n,inner:r}),this.layout.render(),t.layout.main.show(this.layout)},selectPerson:function(n,r,i){if(this.layout==null)return;e.router.navigate(i,!1),t.vent.trigger("message:clear"),this.person=n,this.layout.filter.currentView.model=this.person,this.layout.menu.show(new f({model:this.person,page:r||"info"})),this.layout.aside.show(new h({model:this.person})),this.layout.inner.show(this.getPersonView(r))},selectPersonPage:function(n,r){if(this.layout==null)return;e.router.navigate(r,!1),t.vent.trigger("message:clear"),this.layout.inner.show(this.getPersonView(n))},getPersonView:function(e){switch(e){case"permissions":break;case"accounts":break;case"documents":break;case"document":break;case"photos":return this.person.photos.fetch(),new d({collection:this.person.photos});case"photo":var t=new v({model:this.person.addPhoto(),section:"people"});return n.Validation.bind(t),t;case"info":default:var t=new p({model:this.person});return n.Validation.bind(t),t}}}),e.addInitializer(function(){e.router=new e.Router({controller:new e.Controller})})}),Proof.module("Global",function(e,t,n,r,i,s){var o="proof_auth",u=r.Region,a=t.Security.Models.User,f=t.Security.Models.SignOn,l=t.Models.Messages,c=t.Models.Message,h=t.Views.MessageListView;s.extend(t,{refresh:function(){n.history&&n.history.loadUrl(n.history.fragment||"home")},signOn:function(n){var r=n.get("id");e.session=n,i.cookie(o,r),e.currentUser=new a({id:r}),e.currentUser.fetch().done(function(){t.vent.trigger("security:signedon",e.session,e.currentUser),t.vent.trigger("section:changed",e.section)})},determineAuthenticationStatus:function(){function u(){t.vent.trigger("security:signout")}var e=this,n=i.cookie(o);if(n!=null){var r=new f({id:n}),s=r.fetch({async:!1});s.done(function(){e.signOn(r)}),s.fail(u)}else u()},signOut:function(){this.session&&this.session.destroy(),e.session=new f,e.currentUser=new a,i.removeCookie(o),t.Home.router.navigate("/",!0),t.vent.trigger("security:signedout",e.session,e.currentUser),t.vent.trigger("section:changed",e.section)},showMessage:function(e){this.messages==null?this.messages=new l:this.messageRegion&&this.messageRegion.close(),s.isObject(e)||(e={text:e});var t=new c(e);t.isError()&&this.messages.clearNonErrors(),(!t.isError()&&!this.messages.hasErrors()||t.isError())&&this.messages.add(t),this.messageRegion=new u({el:"#message"}),this.messageRegion.show(new h({collection:this.messages}))},clearMessages:function(){this.messages&&this.messages.reset([])},changeLocale:function(n){i18n.setLng(n),t.vent.trigger("locale:changed",e.session,e.currentUser),t.vent.trigger("section:changed",e.section)},changeSection:function(n){e.section=n,t.vent.trigger("section:changed",e.section)}}),e.addInitializer(function(){t.vent.on("section:change",t.changeSection,this),t.vent.on("security:signon",t.signOn,this),t.vent.on("security:signout",t.signOut,this),t.vent.on("security:signedon",t.refresh,this),t.vent.on("locale:change",t.changeLocale,this),t.vent.on("locale:changed",t.refresh,this),t.vent.on("message:show",t.showMessage,this),t.vent.on("message:clear",t.clearMessages,this),t.vent.on("security:unauthorised",function(){t.vent.trigger("message:show",i18n.t("error.security.unauthorised"))},this),t.determineAuthenticationStatus(),t.vent.trigger("locale:change",i18n.lng())})});